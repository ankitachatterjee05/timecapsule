<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TIME CAPSULE // RSVP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }

    .title-serif {
      font-family: "Times New Roman", Georgia, serif !important;
    }
    
    body {
      margin: 0;
      min-height: 100vh;
      font-family: "SF Mono", Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      background: #000;
      color: #FFFFFF;
      display: flex;
      justify-content: center;
      padding: 40px 12px;
      position: relative;
      overflow-x: hidden;
    }

    @keyframes noiseShift {
      from { transform: translate3d(0, 0, 0); }
      to   { transform: translate3d(-12px, 8px, 0); }
    }

    .frame {
      max-width: 420px;
      width: 100%;
      padding: 24px 20px 18px;
      border: none;              
      border-radius: 0;          
      background: #000;          
      box-shadow: none;          /* remove glow */
      position: relative;
      z-index: 3;
    }

    .system-label {
      letter-spacing: 0.15em;
      font-size: 0.7rem;
      color: #aaa;
      text-transform: uppercase;
      margin-bottom: 8px;
    }

    .hero-image-crop {
      width: 100%;
      height: 180px;      
      display: flex;
      justify-content: center;
      align-items: center;
      background: #000;
      border-radius: 14px;
      margin-bottom: 18px;
      overflow: hidden;
    }
    
    .hero-image-crop img {
      width: auto;
      height: 50%;       
      object-fit: contain;
    }

    @keyframes spin {
      from { transform: rotate(0deg) scale(1.05); }
      to   { transform: rotate(360deg) scale(1.05); }
    }

    h1 {
      font-size: 2.0rem;
      margin: 0 0 4px;
    }

    #glitch-title {
      position: relative;
      display: inline-block;
    }

    .subheader {
      font-size: 0.8rem;
      color: #FFFFFF;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      margin-bottom: 12px;
    }

    .meta-block {
      margin-top: 12px;
      border-top: 1px solid #444;
      padding-top: 10px;
      font-size: 0.8rem;
    }

    .meta-label {
      font-weight: 600;
      color: #bbb;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      font-size: 0.7rem;
      margin-bottom: 4px;
    }

    .meta-value {
      font-size: 0.95rem;
      margin-bottom: 2px;
    }

    .meta-sub {
      font-size: 0.75rem;
      color: #888;
      font-style: italic;
    }

    .description {
      margin-top: 10px;
      font-size: 0.8rem;
      color: #ddd;
      line-height: 1.4;
    }

    .divider {
      border-top: 1px solid #333;
      margin: 18px 0 10px;
    }

    .rsvp-btn {
      margin-top: 14px;
      width: 100%;
      padding: 10px 0;
      border-radius: 10px;
      background: #000;
      border: 1px solid #fff;
      color: #fff;
      text-align: center;
      cursor: pointer;
      font-size: 0.9rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      transition: box-shadow 0.2s, transform 0.1s, background 0.2s;
    }

    .rsvp-btn:hover {
      box-shadow: 0 0 18px rgba(255,255,255,0.65);
      transform: translateY(-1px);
      background: #111;
    }

    .badge-line {
      margin-top: 10px;
      font-size: 0.72rem;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: #aaa;
      text-align: center;
    }

    form {
      margin-top: 18px;
      font-size: 0.85rem;
    }

    .field {
      margin-bottom: 12px;
    }

    .map-wrapper {
      width: 100%;
      aspect-ratio: 16 / 9;
      overflow: hidden;
      border-radius: 14px;
      border: 1px solid #000000;
      margin-top: 8px;
      position: relative;
    }
    
    .map-wrapper img {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 100%;
      height: auto;       
      transform: translate(-50%, -50%);
    }


    label {
      display: block;
      margin-bottom: 4px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      font-size: 0.68rem;
      color: #bbb;
    }

    input {
      width: 100%;
      padding: 7px 9px;
      border-radius: 8px;
      border: 1px solid #555;
      background: #050505;
      color: #f5f5f5;
      font-family: inherit;
      font-size: 0.85rem;
    }

    .submit-btn {
      margin-top: 10px;
      width: 100%;
      padding: 9px 0;
      border-radius: 9px;
      border: none;
      background: #f5f5f5;
      color: #000;
      font-weight: 600;
      letter-spacing: 0.13em;
      text-transform: uppercase;
      cursor: pointer;
    }

    .submit-btn:disabled {
      opacity: 0.6;
      cursor: default;
    }

    .status {
      margin-top: 8px;
      font-size: 0.75rem;
      text-align: center;
      color: #ccc;
      min-height: 1em;
    }

    /* Fake console (currently inactive) */
    .console {
      margin-top: 14px;
      padding-top: 10px;
      border-top: 1px solid #333;
      font-size: 0.7rem;
      color: #9ad1ff;
    }

    .console-label {
      color: #6aa6ff;
      margin-bottom: 4px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }

    .console-line {
      font-family: inherit;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      opacity: 0.9;
    }

    .console-line.dim {
      opacity: 0.6;
    }

    .cursor {
      display: inline-block;
      width: 0.55ch;
      height: 1em;
      background: #9ad1ff;
      margin-left: 3px;
      vertical-align: -0.1em;
      animation: blink 1s steps(1, end) infinite;
    }

    @keyframes blink {
      0%, 50% { opacity: 1; }
      50.01%, 100% { opacity: 0; }
    }
  </style>
</head>
<body>
  <div class="frame">
    <div class="system-label glitchy" data-text="SYSTEM_ALERT_">SYSTEM_ALERT_</div>

    <div class="hero-image-crop">
      <video 
        autoplay 
        loop 
        muted 
        playsinline
        src="video.mp4"
        style="width: auto; height: 100%; object-fit: cover;">
      </video>
    </div>


    <h1>
      <span id="glitch-title" class="glitchy title-serif" data-text="TIME CAPSULE">TIME CAPSULE</span>
    </h1>
    <div class="subheader glitchy" data-text="by Postcrypt Art Gallery">
      by Postcrypt Art Gallery
    </div>

    <div class="meta-block">
      <div class="meta-label glitchy" data-text="EVENING_PROTOCOL">EVENING_PROTOCOL</div>
      <div class="meta-value glitchy" data-text="Saturday, December 6th, 2025">
        Saturday, December 6th, 2025
      </div>
      <div class="meta-value glitchy" data-text="18:00_HRS (arrive promptly)">
        18:00_HRS (arrive promptly)
      </div>
    </div>

    <div class="meta-block">
      <div class="meta-label glitchy" data-text="LOCATION">LOCATION</div>
      <div class="meta-value glitchy" data-text="St. Paul’s Chapel — The Guastavino Room">
        St. Paul’s Chapel — The Guastavino Room
      </div>
      <div class="meta-sub glitchy" data-text="A hidden Postcrypt site, hasn't been open in nearly a decade.">
        A hidden Postcrypt site, hasn't been open in nearly a decade.
      </div>
    </div>

    <div class="description glitchy" data-text="An evening featuring live music, cocktails, and a collaborative craft.">
      An evening featuring <strong>live music</strong> 
      , cocktails, and a collaborative craft.
    </div>

    <button class="rsvp-btn" id="scroll-rsvp">
      <span class="glitchy" data-text="[ RSVP_NOW ]">[ RSVP_NOW ]</span>
    </button>

    <div class="badge-line glitchy" data-text="Live music // limited capacity">
      Live music // limited capacity 
    </div>

    <div class="divider"></div>
    <div class="meta-sub glitchy" data-text="Map to the Crypt...">
        Map to the Crypt...
      </div>

    <!-- MAP SECTION (shown first) -->
    <div id="map-wrapper" class="map-wrapper">
      <img src="map.png" alt="Map to the Crypt..." />
    </div>

    
    <!-- FORM SECTION (hidden until RSVP button is clicked) -->
    <div id="form-wrapper" style="display: none;">
      <form id="rsvp-form">
        <div class="field">
          <label for="name">Name*</label>
          <input id="name" name="name" required />
        </div>
        <div class="field">
          <label for="uni">UNI*</label>
          <input id="uni" name="uni" required />
        </div>
        <div class="field">
          <label for="phone">Phone*</label>
          <input id="phone" name="phone" type="tel" required />
        </div>
    
        <button type="submit" class="submit-btn">Submit RSVP</button>
        <div class="status" id="status"></div>
      </form>
    </div>


    </div>
  </div>

  <script>
    // ========= GLITCHING TEXT (each element glitches independently) =========
    const SIM_MAP = {
      "A": "Δ", "B": "β", "C": "Ϲ", "D": "Ð", "E": "Ξ", "F": "Ғ", "G": "ɢ",
      "H": "Η", "I": "Ι", "J": "ʆ", "K": "Κ", "L": "∟", "M": "Μ", "N": "Η",
      "O": "Ω", "P": "Ρ", "Q": "Θ", "R": "Я", "S": "Ѕ", "T": "Τ", "U": "∪",
      "V": "∨", "W": "Ш", "X": "Χ", "Y": "Ψ", "Z": "Ζ",
      "a": "α", "c": "ϲ", "e": "ε", "i": "ι", "o": "σ", "u": "υ", "s": "ς",
      "t": "τ", "n": "η", "r": "г", "p": "ρ"
    };

    function mapCharSimilar(ch) {
      if (SIM_MAP[ch]) return SIM_MAP[ch];
      if (SIM_MAP[ch.toUpperCase()]) return SIM_MAP[ch.toUpperCase()];
      return ch;
    }
    
    const GLITCH_COLORS = ["#c1ff72"]; // same palette for glitch
    
    function escapeHTML(str) {
      return str
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }
    
    function glitchOnceForElement(el) {
      const original = el.dataset.text || el.textContent;
      if (!original) return;
      el.dataset.text = original;
    
      let frame = 0;
      const maxFrames = 14 + Math.floor(Math.random() * 6);
    
      const timer = setInterval(() => {
        let outHTML = "";
    
        for (let i = 0; i < original.length; i++) {
          const ch = original[i];
    
          // Preserve spaces/newlines without spans
          if (ch === " ") { outHTML += " "; continue; }
          if (ch === "\n") { outHTML += "<br>"; continue; }
    
          const doGlitch = frame < maxFrames && Math.random() < 0.12;
    
          if (doGlitch) {
            const glitchedChar = mapCharSimilar(ch);
            const color = GLITCH_COLORS[Math.floor(Math.random() * GLITCH_COLORS.length)];
    
            outHTML += `<span style="color:${color}">${escapeHTML(glitchedChar)}</span>`;
          } else {
            // normal character, normal color
            outHTML += `<span>${escapeHTML(ch)}</span>`;
          }
        }
    
        el.innerHTML = outHTML;
        frame++;
    
        if (frame >= maxFrames) {
          el.textContent = original;  // restore clean text
          clearInterval(timer);
        }
      }, 70);
    }
    


    // Each element gets its own interval with a random delay
    document.querySelectorAll(".glitchy").forEach((el) => {
      setTimeout(() => {
        glitchOnceForElement(el);
        setInterval(() => {
          glitchOnceForElement(el);
        }, 2500 + Math.random() * 3500); // each 2.2–6.4s
      }, Math.random() * 500);
    });

    // ========= REVEAL FORM ON RSVP BUTTON =========
    const rsvpBtn     = document.getElementById("scroll-rsvp");
    const mapWrapper  = document.getElementById("map-wrapper");
    const formWrapper = document.getElementById("form-wrapper");
    
    rsvpBtn.addEventListener("click", () => {
      // hide the map, show the form
      if (mapWrapper)  mapWrapper.style.display  = "none";
      if (formWrapper) formWrapper.style.display = "block";
    
      // scroll to the form
      const formEl = document.getElementById("rsvp-form");
      if (formEl) {
        formEl.scrollIntoView({ behavior: "smooth", block: "start" });
      }
    });

    // ========= RSVP FORM SUBMIT =========
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyfU0sEmNeUn8THiuWtbeaHYaoej3X_M4EVurDR8Pg7m-6TsS09QCq7jaG1OjShspWG/exec";
    const form = document.getElementById("rsvp-form");
    const statusEl = document.getElementById("status");
    const submitBtn = form.querySelector(".submit-btn");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      statusEl.textContent = "Transmitting…";
      submitBtn.disabled = true;

      const formData = new FormData(form);

      try {
        const res = await fetch(SCRIPT_URL, {
          method: "POST",
          body: new URLSearchParams(formData)
        });
        const data = await res.json();

        if (data.status === "success") {
          statusEl.textContent = "RSVP received. See you at 18:00 sharp.";
          form.reset();
        } else {
          statusEl.textContent = "Glitch detected. Try again.";
        }
      } catch (err) {
        console.error(err);
        statusEl.textContent = "Connection error. Try again in a moment.";
      } finally {
        submitBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
